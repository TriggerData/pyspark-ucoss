FROM mcr.microsoft.com/devcontainers/base:ubuntu

ARG PYTHON_VERSION=3.11.9

SHELL ["/bin/bash", "-lc"]

RUN apt-get update && apt-get install -y locales locales-all

ENV LC_ALL en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US.UTF-8

ENV TZ="Europe/London"

RUN apt-get update && apt-get install -y \
    build-essential \
    ca-certificates \
    cmake \
    curl \
    gdb \
    gfortran \
    git \
    gnupg \
    lcov \
    libatlas-base-dev \
    libblas-dev \
    libblas3 \
    libbz2-dev \
    libffi-dev \
    libfreetype6-dev \
    libgdbm-compat-dev \
    libgdbm-dev \
    libharfbuzz-dev \
    libfribidi-dev \
    libjpeg8-dev \
    liblapack-dev \
    liblapack3 \
    liblcms2-dev \
    liblzma-dev \
    libncurses5-dev \
    libopenjp2-7-dev \
    libreadline6-dev \
    libsqlite3-dev \
    libssl-dev \
    libtiff5-dev \
    libwebp-dev \
    libxcb1-dev \
    lzma \
    lzma-dev \
    openjdk-11-jdk \
    pkg-config \
    python3-dev \
    python3-setuptools \
    python3-tk \
    python3.10-venv \
    tcl8.6-dev \
    tk-dev \
    tk8.6-dev \
    unzip \
    uuid-dev \
    zlib1g-dev \
    zlib1g-dev \
    zsh

RUN chsh -s $(which zsh) vscode

RUN cd /tmp && \
    wget https://github.com/gitleaks/gitleaks/releases/download/v8.18.4/gitleaks_8.18.4_linux_x64.tar.gz && \
    tar -xzvf gitleaks_8.18.4_linux_x64.tar.gz && \
    mv gitleaks /usr/bin/gitleaks

USER vscode

RUN git clone https://github.com/asdf-vm/asdf.git ~/.asdf && \
    echo ". ~/.asdf/asdf.sh" >> ~/.bashrc && \
    echo ". ~/.asdf/asdf.sh" >> ~/.zshrc

RUN source ~/.asdf/asdf.sh && asdf plugin-add python && \
    asdf install python ${PYTHON_VERSION} && \
    asdf global python ${PYTHON_VERSION} && \
    asdf plugin add pre-commit && \
    asdf install pre-commit 3.4.0 && \
    asdf global pre-commit 3.4.0 && \
    pip install -U pip && \
    pip install git-filter-repo

RUN curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash

RUN curl -sSL https://pdm.fming.dev/install-pdm.py | python3 -

RUN curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sudo bash

ENV PATH /home/vscode/.local/bin:$PATH
